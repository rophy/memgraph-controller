apiVersion: skaffold/v4beta11
kind: Config

metadata:
  name: memgraph-cluster

# Build configuration for the controller and test client
build:
  artifacts:
  - image: memgraph-controller
    context: .
    docker:
      dockerfile: Dockerfile
  - image: neo4j-client
    context: tests/client
    docker:
      dockerfile: Dockerfile

# Default deploy configuration (memgraph + controller + test client)
deploy:
  helm:
    releases:
    - name: memgraph-ha
      chartPath: charts/memgraph-ha
      namespace: memgraph
      createNamespace: true
      wait: true
    - name: test-client
      chartPath: tests/client/charts/test-client
      namespace: memgraph
      createNamespace: false
      wait: false
      setValues:
        neo4j.uri: "bolt://memgraph-controller:7687"
        writeInterval: "1000"
  logs:
    prefix: podAndContainer
# Port forwarding for development (default profile - memgraph + controller)
portForward:
- resourceType: service
  resourceName: memgraph-controller
  namespace: memgraph
  port: 7687
  localPort: 7687
- resourceType: service
  resourceName: memgraph-controller
  namespace: memgraph
  port: 8080
  localPort: 8080
- resourceType: service
  resourceName: memgraph-ha
  namespace: memgraph
  port: 7687
  localPort: 7688

# Profiles for different deployment scenarios
profiles:
# Profile for deploying only Memgraph cluster (no controller, no port forwarding)
- name: memgraph-only
  deploy:
    helm:
      releases:
      - name: memgraph
        chartPath: charts/memgraph
        namespace: memgraph
        createNamespace: true
        wait: true
