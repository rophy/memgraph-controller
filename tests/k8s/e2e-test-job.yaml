apiVersion: batch/v1
kind: Job
metadata:
  name: e2e-test
  namespace: memgraph
  labels:
    app: e2e-test
spec:
  template:
    metadata:
      labels:
        app: e2e-test
    spec:
      serviceAccountName: e2e-test-sa
      restartPolicy: Never
      containers:
      - name: e2e-test
        image: e2e-test
        env:
        - name: GO_TEST_TIMEOUT
          value: "10m"
        resources:
          requests:
            cpu: "100m"
            memory: "128Mi"
          limits:
            cpu: "500m"
            memory: "512Mi"
        # Test will run and exit, Job handles success/failure
        command: ["/usr/local/bin/e2e-tests"]
        args: ["-test.v", "-test.timeout=10m"]
  backoffLimit: 0  # Allow up to 2 retries for flaky tests